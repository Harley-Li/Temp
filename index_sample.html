<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Wealth AI - Conversational Dashboard</title>
    <!-- Google Fonts for modern/futuristic look -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Global Styles & Variables */
        :root {
            --bg-dark: #0a0a1a; /* Even darker, sleeker background */
            --bg-light-blue: #18253a; /* Slightly lighter blue for subtle variation */
            --primary-blue: #081e33; /* Darker blue for chat bubbles/elements */
            --accent-cyan: #00e5ff; /* Brighter, more vibrant cyan for highlights and links */
            --text-light: #e0e0e0; /* Light text for readability */
            --text-muted: #a0a0a0; /* Muted text for secondary info */
            --card-bg-transparent: rgba(255, 255, 255, 0.04); /* Lighter transparency for more pronounced glassmorphism */
            --border-color: rgba(255, 255, 255, 0.08); /* Subtle border for elements */
            --shadow-light: rgba(0, 0, 0, 0.4); /* General shadow for depth */
            --shadow-glow: rgba(0, 229, 255, 0.6); /* Stronger cyan glow for interactive/important elements */
            --border-radius-main: 25px; /* Larger main container radius */
            --border-radius-sm: 12px; /* Smaller radius for internal cards/elements */
            --progress-green: #50fa7b; /* Bright green for progress */
            --progress-red: #ff6e6e; /* Bright red for negative aspects */
            --portfolio-stock: #4CAF50; /* Green */
            --portfolio-bond: #2196F3; /* Blue */
            --portfolio-cash: #FFC107; /* Amber */
            --portfolio-crypto: #9C27B0; /* Purple */
        }

        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, var(--bg-dark), var(--primary-blue)); /* Smooth background gradient */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: var(--text-light);
            overflow: hidden; /* Prevents unwanted body scroll */
            -webkit-font-smoothing: antialiased; /* Smoother font rendering */
            -moz-osx-font-smoothing: grayscale;
        }

        /* Main Container - The "Brain" of the UI */
        .main-container {
            display: flex;
            width: 95%;
            max-width: 1600px; /* Even wider container */
            height: 90vh;
            max-height: 980px;
            border-radius: var(--border-radius-main);
            box-shadow: 0 20px 60px var(--shadow-light), 0 0 50px var(--shadow-glow); /* Pronounced shadow with glow */
            overflow: hidden;
            background: var(--card-bg-transparent); /* Base for glassmorphism */
            backdrop-filter: blur(25px); /* Stronger glass effect */
            border: 1px solid var(--border-color);
        }

        /* Left Panel - The "Dashboard" Side */
        .left-panel {
            flex: 1.5; /* Larger left panel, takes 60% approx (1.5 / (1.5+1) = 0.6) */
            padding: 35px;
            display: flex;
            flex-direction: column;
            gap: 35px; /* Spacing between sections */
            border-right: 1px solid var(--border-color);
            overflow-y: auto; /* Scrollable for content */
            background-color: rgba(0, 0, 0, 0.15); /* Slightly darker for contrast against main container */
            position: relative; /* For the focus effect */
            transition: background-color 0.3s ease; /* Smooth background transition */
        }

        /* Custom Scrollbar for left panel */
        .left-panel::-webkit-scrollbar { width: 10px; }
        .left-panel::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); border-radius: 10px; }
        .left-panel::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.25); border-radius: 10px; }
        .left-panel::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.4); }

        /* General Panel Section Styling */
        .panel-section {
            background: var(--card-bg-transparent);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            padding: 30px;
            box-shadow: 0 8px 25px var(--shadow-light);
            position: relative;
            overflow: hidden;
            transition: all 0.4s ease-in-out; /* For smooth focus effect */
            min-height: 150px; /* Ensure sections have some height even if content is sparse */
        }
        .panel-section.hidden { display: none; } /* Used for dynamic content switching */
        
        /* Focus effect for sections - triggered by JS */
        .panel-section.focused {
            background-color: rgba(0, 229, 255, 0.08); /* A light cyan tint */
            border-color: var(--accent-cyan); /* Bright cyan border */
            box-shadow: 0 0 30px var(--shadow-glow); /* Stronger glow when focused */
        }

        /* Panel Section Header */
        .panel-section h4 {
            margin-top: 0;
            margin-bottom: 25px;
            font-size: 1.4em;
            color: var(--accent-cyan); /* Cyan heading */
            border-bottom: 1px solid rgba(0, 229, 255, 0.25); /* Subtle cyan underline */
            padding-bottom: 12px;
            font-family: 'Orbitron', sans-serif; /* Futuristic font for headings */
            letter-spacing: 0.8px;
        }

        /* Dashboard Header - Top section of Left Panel */
        .dashboard-header {
            display: flex; align-items: center; gap: 20px;
            background: transparent; border: none; box-shadow: none; padding: 0;
        }
        .user-avatar {
            width: 80px; height: 80px;
            border-radius: 50%;
            background-color: var(--accent-cyan);
            display: flex; justify-content: center; align-items: center;
            font-size: 2.2em; font-weight: bold;
            color: var(--bg-dark);
            box-shadow: 0 0 25px var(--shadow-glow);
            font-family: 'Orbitron', sans-serif;
        }
        .user-info h3 { margin: 0; font-size: 1.8em; color: var(--accent-cyan); font-family: 'Orbitron', sans-serif; letter-spacing: 1px; }
        .user-info p { margin: 8px 0 0; font-size: 1.1em; color: var(--text-muted); }

        /* Common Overview Section */
        .common-overview h4 { margin-top: 0; }
        .common-overview .weather-info, .common-overview .market-indices, .common-overview .news-headlines {
            margin-bottom: 20px; padding: 15px; border-radius: var(--border-radius-sm);
            background: rgba(0, 0, 0, 0.15); border: 1px solid rgba(255,255,255,0.05);
        }
        .common-overview p { margin: 8px 0; font-size: 1em; }
        .common-overview .market-indices span { display: inline-block; margin-right: 20px; font-weight: bold; }
        .common-overview .market-indices .up { color: var(--progress-green); }
        .common-overview .market-indices .down { color: var(--progress-red); }
        .common-overview ul { list-style: none; padding: 0; margin: 0; }
        .common-overview ul li { margin-bottom: 10px; font-size: 0.95em; color: var(--text-muted); }
        .common-overview ul li a { color: var(--accent-cyan); text-decoration: none; transition: color 0.2s ease; }
        .common-overview ul li a:hover { color: #fff; }

        /* Portfolio Summary Section */
        .portfolio-summary p { margin: 10px 0; font-size: 1.05em; }
        .portfolio-summary strong { color: var(--accent-cyan); font-family: 'Orbitron', sans-serif; }
        .portfolio-summary .gain { color: var(--progress-green); }
        .portfolio-summary .loss { color: var(--progress-red); }
        
        .chart-container {
            display: flex; flex-direction: column; gap: 20px; margin-top: 20px;
        }
        .chart-item {
            background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: var(--border-radius-sm);
            border: 1px solid rgba(255,255,255,0.08);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
        }
        .chart-item h5 { margin: 0 0 15px; font-size: 1.1em; color: var(--text-light); border-bottom: 1px dashed rgba(255,255,255,0.1); padding-bottom: 8px; }

        /* Donut Chart (Simulated with conic-gradient) */
        .donut-chart {
            width: 150px; height: 150px; border-radius: 50%; margin: 0 auto 15px;
            position: relative; display: flex; align-items: center; justify-content: center;
            font-size: 0.9em; font-weight: bold; color: var(--text-light);
            background: conic-gradient(
                var(--portfolio-stock) 0% var(--stock-percent, 0%),
                var(--portfolio-bond) var(--stock-percent, 0%) calc(var(--stock-percent, 0%) + var(--bond-percent, 0%)),
                var(--portfolio-cash) calc(var(--stock-percent, 0%) + var(--bond-percent, 0%)) calc(var(--stock-percent, 0%) + var(--bond-percent, 0%) + var(--cash-percent, 0%)),
                var(--portfolio-crypto) calc(var(--stock-percent, 0%) + var(--bond-percent, 0%) + var(--cash-percent, 0%)) 100%
            );
        }
        .donut-chart::before {
            content: ''; position: absolute; background-color: var(--primary-blue);
            width: 60%; height: 60%; border-radius: 50%; z-index: 1;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.5);
        }
        .donut-chart span { z-index: 2; } /* Text inside donut hole */

        .breakdown-legend {
            display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-top: 10px;
        }
        .legend-item { display: flex; align-items: center; font-size: 0.9em; color: var(--text-muted); }
        .legend-color { width: 15px; height: 15px; border-radius: 3px; margin-right: 5px; }

        /* Stacked Bar Chart (Simulated) */
        .stacked-bar-chart {
            height: 120px; display: flex; align-items: flex-end; gap: 2px;
            background: rgba(0, 0, 0, 0.1); border-radius: var(--border-radius-sm); padding: 5px;
            border: 1px dashed rgba(255,255,255,0.1);
        }
        .bar-segment {
            flex-grow: 1; display: flex; flex-direction: column; justify-content: flex-end;
            width: calc(100% / var(--num-bars) - 2px); /* Distribute bars */
            background-color: var(--primary-blue);
            border-top-left-radius: 3px; border-top-right-radius: 3px;
            position: relative;
            transition: height 0.5s ease-out; /* Smooth height change */
        }
        .bar-segment span {
            display: block; width: 100%;
            background-color: var(--segment-color);
            height: var(--segment-height);
            transition: height 0.5s ease-out;
        }
        .bar-segment:hover {
            box-shadow: 0 0 10px rgba(0,229,255,0.5);
        }
        .bar-label {
            position: absolute; top: -20px; left: 50%; transform: translateX(-50%);
            font-size: 0.7em; color: var(--text-muted); white-space: nowrap;
        }
        .bar-date {
            font-size: 0.7em; color: var(--text-muted); text-align: center; margin-top: 5px;
        }


        /* Financial Goals Section */
        .financial-goals-list { display: flex; flex-direction: column; gap: 25px; }
        .goal-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 22px; border-radius: var(--border-radius-sm);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: inset 0 0 12px rgba(0, 229, 255, 0.18);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .goal-item:hover {
            transform: translateY(-5px);
            box-shadow: inset 0 0 25px rgba(0, 229, 255, 0.3), 0 10px 30px rgba(0,0,0,0.6);
        }
        .goal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .goal-header h5 { margin: 0; font-size: 1.3em; color: var(--accent-cyan); font-family: 'Orbitron', sans-serif; }
        .goal-header .progress-text { font-size: 1.1em; font-weight: bold; color: var(--progress-green); }
        .goal-item p { margin: 8px 0; font-size: 0.95em; color: var(--text-muted); }

        /* Circular Progress Bar (Simulated with conic-gradient) */
        .circular-progress {
            width: 80px; height: 80px; border-radius: 50%;
            background: var(--primary-blue); /* Background of the circle */
            position: relative; margin: 15px auto 0;
            display: flex; justify-content: center; align-items: center;
            font-size: 0.8em; font-weight: bold; color: var(--text-light);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
            overflow: hidden; /* Hide overflow of progress bar */
        }
        .circular-progress::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            border-radius: 50%;
            background: conic-gradient(
                var(--progress-green) var(--progress-percent, 0%),
                transparent var(--progress-percent, 0%)
            );
            transition: background 0.6s ease-out; /* Smooth color fill */
            mask: radial-gradient(farthest-side, transparent calc(50% - 12px), #000 calc(50% - 10px)); /* Donut hole effect */
            -webkit-mask: radial-gradient(farthest-side, transparent calc(50% - 12px), #000 calc(50% - 10px));
        }
        .circular-progress span { z-index: 1; } /* Text inside the hole */

        /* Goal Comparison */
        .goal-comparison {
            background-color: rgba(0, 229, 255, 0.1);
            border: 1px solid var(--accent-cyan);
            border-radius: var(--border-radius-sm);
            padding: 15px; margin-top: 15px;
            font-size: 0.9em;
            display: none; /* Hidden by default */
            animation: fadeInMessage 0.4s ease-out forwards;
        }
        .goal-comparison p { margin: 5px 0; }
        .goal-comparison strong { color: var(--accent-cyan); }
        .goal-comparison .old-value { text-decoration: line-through; color: var(--text-muted); margin-right: 10px; }
        .goal-comparison .new-value { color: var(--progress-green); font-weight: bold; }


        /* Risk Control Section */
        .risk-control p { margin: 10px 0; font-size: 1em; }
        .risk-level { font-weight: bold; color: var(--accent-cyan); font-family: 'Orbitron', sans-serif; font-size: 1.1em; }
        .risk-assessment ul { list-style: none; padding: 0; margin: 15px 0 0; }
        .risk-assessment ul li { margin-bottom: 10px; font-size: 0.95em; color: var(--text-muted); }


        .add-goal-button {
            display: block; width: 100%;
            padding: 15px; margin-top: 30px;
            background-color: var(--accent-cyan);
            color: var(--bg-dark); border: none; border-radius: var(--border-radius-sm);
            cursor: pointer; font-size: 1.1em; font-weight: bold;
            transition: background-color 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
            box-shadow: 0 0 20px rgba(0, 229, 255, 0.5);
        }
        .add-goal-button:hover {
            background-color: #00ffff; transform: translateY(-4px);
            box-shadow: 0 0 35px rgba(0, 229, 255, 0.7);
        }
        .add-goal-button:active {
            transform: translateY(0); background-color: #00bbd4;
            box-shadow: 0 0 10px rgba(0, 229, 255, 0.3);
        }

        /* Right Panel - The "Chatbot" Side */
        .chat-container {
            flex: 1; /* Smaller right panel, takes 40% approx */
            display: flex; flex-direction: column;
            background-color: rgba(0, 0, 0, 0.25);
            position: relative;
            box-shadow: inset 0 0 40px rgba(0,0,0,0.7);
            transition: background-color 0.3s ease;
        }

        /* Chat Header */
        .chat-header {
            background-color: rgba(0, 0, 0, 0.6);
            color: var(--text-light); padding: 22px 30px;
            display: flex; align-items: center;
            border-bottom: 1px solid var(--border-color);
            box-shadow: 0 3px 20px rgba(0,0,0,0.4);
        }
        .chat-header .logo {
            width: 50px; height: 50px;
            background: linear-gradient(45deg, #0099ff, var(--accent-cyan));
            border-radius: 50%; margin-right: 20px;
            display: flex; justify-content: center; align-items: center;
            font-weight: bold; color: #fff; font-size: 1.5em;
            font-family: 'Orbitron', sans-serif;
            box-shadow: 0 0 25px var(--shadow-glow);
        }
        .chat-header h2 { margin: 0; font-size: 1.5em; font-weight: 500; color: var(--accent-cyan); letter-spacing: 1px; }
        .chat-header .status { margin-left: auto; font-size: 1em; color: var(--progress-green); display: flex; align-items: center; }
        .chat-header .status::before { content: ''; display: inline-block; width: 12px; height: 12px; background-color: var(--progress-green); border-radius: 50%; margin-right: 8px; box-shadow: 0 0 12px var(--progress-green); }

        /* Chat Messages Area */
        .chat-messages {
            flex-grow: 1; padding: 30px 35px; overflow-y: auto;
            display: flex; flex-direction: column; gap: 18px;
            background-color: transparent; position: relative;
        }
        /* Custom Scrollbar for chat messages */
        .chat-messages::-webkit-scrollbar { width: 10px; }
        .chat-messages::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); border-radius: 10px; }
        .chat-messages::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.25); border-radius: 10px; }
        .chat-messages::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.4); }

        /* Message Bubble Styles */
        .message {
            max-width: 85%; padding: 18px 25px; border-radius: 28px;
            word-wrap: break-word; line-height: 1.7;
            opacity: 0; transform: translateY(25px);
            animation: fadeInMessage 0.4s ease-out forwards;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }
        .bot-message {
            background-color: var(--primary-blue); align-self: flex-start;
            color: var(--text-light); border-bottom-left-radius: 10px;
            border: 1px solid rgba(0, 229, 255, 0.3);
            box-shadow: 0 0 25px rgba(0, 229, 255, 0.2);
        }
        .user-message {
            background: linear-gradient(45deg, #007bff, var(--accent-cyan)); align-self: flex-end;
            color: #fff; border-bottom-right-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 0 25px rgba(0, 123, 255, 0.4);
        }
        .message a { color: #00ffff; text-decoration: none; font-weight: 500; transition: color 0.2s ease, text-decoration 0.2s ease; }
        .message a:hover { color: #fff; text-decoration: underline; }

        /* Typing Indicator */
        .typing-indicator {
            align-self: flex-start; padding: 15px 22px;
            background-color: var(--primary-blue); border-radius: 25px; border-bottom-left-radius: 8px;
            font-style: italic; color: var(--text-muted); font-size: 1em;
            opacity: 0; transform: translateY(20px);
            animation: fadeInMessage 0.3s ease-out forwards;
            display: flex; align-items: center; gap: 6px;
        }
        .typing-indicator span { /* Dots for typing indicator */
            display: inline-block; width: 10px; height: 10px;
            background-color: var(--accent-cyan); border-radius: 50%;
            animation: bounce 1.2s infinite ease-in-out;
            box-shadow: 0 0 10px var(--accent-cyan);
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

        /* Inline Adjustment Controls in Chat */
        .inline-adjust-controls {
            display: flex; flex-direction: column; gap: 15px; margin-top: 15px;
            padding: 15px; border-radius: var(--border-radius-sm);
            background: rgba(0, 0, 0, 0.2); border: 1px dashed rgba(255,255,255,0.1);
        }
        .inline-adjust-controls label { font-size: 0.95em; color: var(--text-light); margin-bottom: 5px; display: block;}
        .inline-adjust-controls input[type="range"] {
            width: 100%; height: 8px; background: rgba(0,0,0,0.4); border-radius: 5px;
            outline: none; -webkit-appearance: none;
            transition: background 0.2s;
        }
        .inline-adjust-controls input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; width: 20px; height: 20px; border-radius: 50%;
            background: var(--accent-cyan); cursor: pointer;
            box-shadow: 0 0 10px var(--shadow-glow); margin-top: -6px;
        }
        .inline-adjust-controls input[type="range"]::-moz-range-thumb {
            width: 20px; height: 20px; border-radius: 50%;
            background: var(--accent-cyan); cursor: pointer;
            box-shadow: 0 0 10px var(--shadow-glow);
        }
        .inline-adjust-controls input[type="range"]::-webkit-slider-runnable-track {
            background: linear-gradient(to right, var(--progress-green) var(--fill-percent, 0%), rgba(0,0,0,0.4) var(--fill-percent, 0%));
            border-radius: 5px;
        }
        .inline-adjust-controls input[type="date"] {
            background-color: rgba(0,0,0,0.3); color: var(--text-light);
            border: 1px solid var(--border-color); border-radius: 8px;
            padding: 10px 15px; font-size: 1em;
            outline: none; cursor: pointer;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .inline-adjust-controls input[type="date"]:focus {
            border-color: var(--accent-cyan); box-shadow: 0 0 0 3px rgba(0, 229, 255, 0.25);
        }
        .inline-adjust-controls .control-value { font-size: 1.1em; font-weight: bold; color: var(--accent-cyan); margin-bottom: 10px;}
        .inline-adjust-controls .confirm-button {
            background: linear-gradient(45deg, #007bff, var(--accent-cyan));
            color: #fff; border: none; border-radius: 25px;
            padding: 10px 20px; margin-top: 15px;
            cursor: pointer; font-size: 1em; font-weight: 500;
            transition: background 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
            box-shadow: 0 2px 10px rgba(0, 123, 255, 0.25);
        }
        .inline-adjust-controls .confirm-button:hover { background: linear-gradient(45deg, #0056b3, #00a0be); transform: translateY(-2px); box-shadow: 0 5px 20px rgba(0, 123, 255, 0.4); }


        /* Quick Replies Buttons */
        .quick-replies {
            display: flex; flex-wrap: wrap; justify-content: flex-start;
            padding: 20px 35px; border-top: 1px solid var(--border-color);
            background-color: rgba(0, 0, 0, 0.4);
            gap: 15px; max-height: 200px; overflow-y: auto;
        }
        /* Custom Scrollbar for quick replies */
        .quick-replies::-webkit-scrollbar { width: 8px; }
        .quick-replies::-webkit-scrollbar-track { background: rgba(255,255,255,0.04); border-radius: 10px; }
        .quick-replies::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 10px; }

        .quick-reply-button {
            background-color: var(--bg-light-blue); color: var(--accent-cyan);
            border: 1px solid var(--accent-cyan); padding: 12px 28px;
            border-radius: 35px; cursor: pointer; font-size: 1em;
            transition: background-color 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
            white-space: nowrap; flex-shrink: 0;
            box-shadow: 0 0 12px rgba(0, 229, 255, 0.3);
        }
        .quick-reply-button:hover {
            background-color: var(--accent-cyan); color: var(--bg-dark);
            transform: translateY(-4px); box-shadow: 0 0 25px var(--shadow-glow);
        }
        .quick-reply-button:active {
            transform: translateY(0); background-color: #00bbd4;
            box-shadow: 0 0 10px rgba(0, 229, 255, 0.15);
        }

        /* Input Area */
        .chat-input-area {
            display: flex; padding: 22px 35px; border-top: 1px solid var(--border-color);
            background-color: rgba(0, 0, 0, 0.5);
            box-shadow: 0 -4px 20px rgba(0,0,0,0.4);
        }
        .chat-input-area .message-input {
            flex-grow: 1; padding: 16px 28px;
            border: 1px solid var(--border-color); border-radius: 35px; font-size: 1.1em;
            outline: none; background-color: rgba(0, 0, 0, 0.3);
            color: var(--text-light);
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .chat-input-area .message-input::placeholder { color: var(--text-muted); }
        .chat-input-area .message-input:focus {
            border-color: var(--accent-cyan);
            box-shadow: 0 0 0 5px rgba(0, 229, 255, 0.3), 0 0 20px rgba(0, 229, 255, 0.6);
        }
        .chat-input-area .send-button {
            background: linear-gradient(45deg, #007bff, var(--accent-cyan));
            color: #fff; border: none; border-radius: 35px;
            padding: 16px 32px; margin-left: 20px;
            cursor: pointer; font-size: 1.1em; font-weight: 500;
            transition: background 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
        }
        .chat-input-area .send-button:hover {
            background: linear-gradient(45deg, #0056b3, #00a0be);
            transform: translateY(-4px); box-shadow: 0 8px 30px rgba(0, 123, 255, 0.6);
        }
        .chat-input-area .send-button:active {
            transform: translateY(0); background: linear-gradient(45deg, #004d99, #0087a0);
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.2);
        }

        /* Animations */
        @keyframes fadeInMessage { from { opacity: 0; transform: translateY(25px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .main-container { flex-direction: column; height: 95vh; width: 95%; border-radius: 0; overflow-y: auto; }
            .left-panel { border-right: none; border-bottom: 1px solid var(--border-color); flex: none; height: auto; min-height: 400px; padding: 25px; gap: 25px;}
            .chat-container { flex: 1; height: auto; min-height: 500px; border-radius: 0 0 var(--border-radius-main) var(--border-radius-main); padding: 25px; }
            .panel-section { padding: 25px; min-height: unset; }
            .chat-header, .chat-input-area, .quick-replies { padding: 18px 25px; }
            .chat-messages { padding: 18px 25px; }
            .quick-reply-button { padding: 10px 20px; font-size: 0.95em; }
            .user-avatar { width: 70px; height: 70px; font-size: 2em; }
            .user-info h3 { font-size: 1.6em; }
        }

        @media (max-width: 768px) {
            .main-container { width: 100%; height: 100vh; border-radius: 0; }
            .left-panel, .chat-container { min-height: unset; padding: 15px; }
            .panel-section { padding: 15px; }
            .chat-header .logo { width: 45px; height: 45px; font-size: 1.3em; }
            .chat-header h2 { font-size: 1.4em; }
            .chat-input-area .message-input, .chat-input-area .send-button { padding: 12px 20px; font-size: 1em; }
            .user-avatar { width: 60px; height: 60px; font-size: 1.8em; }
            .user-info h3 { font-size: 1.4em; }
            .panel-section h4 { font-size: 1.2em; }
            .goal-item h5 { font-size: 1.2em; }
            .quick-reply-button { font-size: 0.9em; padding: 8px 18px; }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="left-panel">
            <!-- Common Overview Section - Default visible -->
            <div class="panel-section common-overview" id="commonOverview">
                <h4>General Overview</h4>
                <div class="dashboard-header">
                    <div class="user-avatar">JD</div>
                    <div class="user-info">
                        <h3>Welcome, John Doe</h3>
                        <p>Your Personal Wealth Dashboard</p>
                    </div>
                </div>
                <div class="weather-info">
                    <p><strong>Current Weather:</strong> Sunny, 25Â°C in New York. Looks like a good day for growth!</p>
                </div>
                <div class="market-indices">
                    <p><strong>Market Performance:</strong></p>
                    <span>S&P 500: <strong class="up">+0.5%</strong></span>
                    <span>Nasdaq: <strong class="up">+1.2%</strong></span>
                    <span>Dow Jones: <strong class="down">-0.1%</strong></span>
                </div>
                <div class="news-headlines">
                    <p><strong>Latest Financial News:</strong></p>
                    <ul>
                        <li><a href="#" target="_blank">Tech giants report record quarterly earnings.</a></li>
                        <li><a href="#" target="_blank">Interest rate hike expected next quarter.</a></li>
                        <li><a href="#" target="_blank">New investment opportunities in sustainable energy.</a></li>
                    </ul>
                </div>
            </div>

            <!-- Portfolio Details Section - Hidden by default, shown on demand -->
            <div class="panel-section portfolio-summary hidden" id="portfolioDetails">
                <h4>Portfolio Summary</h4>
                <p>Total Assets: <strong id="totalAssets">$1,250,000</strong></p>
                <p>Today's Gain/Loss: <span id="todayGainLoss" class="gain">+$3,500 (+0.28%)</span></p>
                
                <div class="chart-container">
                    <div class="chart-item">
                        <h5>Asset Allocation</h5>
                        <div class="donut-chart" id="assetAllocationChart">
                            <span>60% Stocks</span>
                        </div>
                        <div class="breakdown-legend" id="assetBreakdownLegend">
                            <!-- Legend items will be added here -->
                        </div>
                    </div>
                    <div class="chart-item">
                        <h5>Balance History (Last 6 Months)</h5>
                        <div class="stacked-bar-chart" id="balanceHistoryChart">
                            <!-- Bars will be added here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Financial Goals Section - Hidden by default, shown on demand -->
            <div class="panel-section financial-goals hidden" id="financialGoalsDetails">
                <h4>Your Financial Goals</h4>
                <div class="goal-comparison" id="goalComparison">
                    <!-- Comparison details will be added here -->
                </div>
                <div class="financial-goals-list" id="financialGoalsList">
                    <!-- Goal items will be dynamically added here -->
                </div>
                <button class="add-goal-button" id="addGoalButton">Set New Goal</button>
            </div>

            <!-- Risk Control Section - Hidden by default, shown on demand -->
            <div class="panel-section risk-control hidden" id="riskControl">
                <h4>Risk Assessment & Control</h4>
                <p>Your current risk profile: <span class="risk-level" id="userRiskLevel">Moderate</span></p>
                <p>Based on your profile, your investments are managed to align with your comfort level for volatility and potential returns.</p>
                <div class="risk-assessment">
                    <h5>Key Risk Insights:</h5>
                    <ul>
                        <li><strong>Diversification:</strong> Your portfolio is well-diversified across different asset classes, reducing single-asset risk.</li>
                        <li><strong>Liquidity:</strong> Sufficient cash reserves are maintained for short-term needs, minimizing forced selling of assets.</li>
                        <li><strong>Market Volatility:</strong> While market fluctuations are normal, your portfolio includes assets designed to offer some protection during downturns.</li>
                        <li><strong>Recommendation:</strong> Consider a yearly risk profile re-assessment to ensure your strategy remains aligned with your evolving financial situation and market conditions.</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="right-panel chat-container">
            <div class="chat-header">
                <div class="logo">QW</div>
                <h2>Quantum Wealth AI</h2>
                <div class="status">Online</div>
            </div>
            <div class="chat-messages" id="chatMessages">
                <!-- Messages will be dynamically added here -->
            </div>
            <div class="quick-replies" id="quickReplies">
                <!-- Quick reply buttons will be dynamically added here -->
            </div>
            <div class="chat-input-area">
                <input type="text" id="messageInput" class="message-input" placeholder="Type your message..." autocomplete="off">
                <button id="sendButton" class="send-button">Send</button>
            </div>
        </div>
    </div>

    <script>
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const quickRepliesContainer = document.getElementById('quickReplies');
        const financialGoalsList = document.getElementById('financialGoalsList');
        const addGoalButton = document.getElementById('addGoalButton');

        // Left Panel Sections
        const commonOverviewSection = document.getElementById('commonOverview');
        const portfolioDetailsSection = document.getElementById('portfolioDetails');
        const financialGoalsSection = document.getElementById('financialGoalsDetails');
        const riskControlSection = document.getElementById('riskControl');
        const goalComparisonDiv = document.getElementById('goalComparison');

        let currentStep = 'initial'; // State for bot conversation flow
        let currentGoal = {}; // Temporarily store goal details during setting
        let adjustingGoalId = null; // Stores the ID of the goal being adjusted for adjustment flow
        let adjustingProperty = null; // Stores 'amount' or 'date' for adjustment
        let oldGoalSnapshot = null; // To store goal state before adjustment for comparison

        // --- Mock Data (can be replaced by API calls in a real application) ---
        let userGoals = [
            { id: 'house', name: 'Buy a Larger House', targetAmount: 800000, currentAmount: 400000, targetDate: '2028-12-31' },
            { id: 'car', name: 'New Car Purchase', targetAmount: 60000, currentAmount: 36000, targetDate: '2025-06-30' },
            { id: 'retirement', name: 'Retirement Fund', targetAmount: 3000000, currentAmount: 900000, targetDate: '2040-09-30' }
        ];

        let portfolioData = {
            totalAssets: 1250000,
            todayGainLoss: 3500,
            todayGainLossPercent: 0.28,
            breakdown: [
                { type: 'Stocks', value: 750000, percentage: 60, color: 'var(--portfolio-stock)' },
                { type: 'Bonds', value: 375000, percentage: 30, color: 'var(--portfolio-bond)' },
                { type: 'Cash', value: 125000, percentage: 10, color: 'var(--portfolio-cash)' },
                // { type: 'Crypto', value: 0, percentage: 0, color: 'var(--portfolio-crypto)' } // Example for more types
            ],
            history: [
                { month: 'Jan', stocks: 600000, bonds: 300000, cash: 100000 },
                { month: 'Feb', stocks: 620000, bonds: 310000, cash: 105000 },
                { month: 'Mar', stocks: 650000, bonds: 320000, cash: 110000 },
                { month: 'Apr', stocks: 680000, bonds: 330000, cash: 115000 },
                { month: 'May', stocks: 720000, bonds: 350000, cash: 120000 },
                { month: 'Jun', stocks: 750000, bonds: 375000, cash: 125000 }
            ]
        };

        let userRiskProfile = {
            level: 'Moderate',
            description: 'You are comfortable with a balanced approach to investing, seeking growth while accepting some level of risk to preserve capital.',
            recommendations: [
                'Maintain diversification across asset classes.',
                'Regularly review your risk tolerance and adjust allocations as needed.',
                'Consider dollar-cost averaging for long-term investments to mitigate volatility.'
            ]
        };

        // --- Utility Functions ---

        // Shows the "AI is typing..." indicator
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.classList.add('typing-indicator');
            typingDiv.innerHTML = '<span></span><span></span><span></span> Quantum Wealth AI is typing...';
            chatMessages.appendChild(typingDiv);
            scrollToBottom();
            return typingDiv;
        }

        // Removes the typing indicator
        function removeTypingIndicator(indicator) {
            if (indicator && chatMessages.contains(indicator)) {
                chatMessages.removeChild(indicator);
            }
        }

        // Appends a new message (bot or user) to the chat window
        function appendMessage(sender, text, isHtml = false) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', `${sender}-message`);
            if (isHtml) {
                messageDiv.innerHTML = text; // Allow raw HTML for interactive elements
            } else {
                messageDiv.textContent = text;
            }
            chatMessages.appendChild(messageDiv);
            scrollToBottom();
            return messageDiv; // Return the message div for potential manipulation
        }

        // Scrolls the chat window to the bottom
        function scrollToBottom() {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Adds quick reply buttons below the chat input
        function addQuickReplies(replies) {
            quickRepliesContainer.innerHTML = ''; // Clear existing buttons
            if (replies && replies.length > 0) {
                quickRepliesContainer.style.display = 'flex'; // Show container
                replies.forEach(reply => {
                    const button = document.createElement('button');
                    button.classList.add('quick-reply-button');
                    button.textContent = reply;
                    // Simulate user input when a quick reply is clicked
                    button.onclick = () => handleUserInput(reply, true);
                    quickRepliesContainer.appendChild(button);
                });
            } else {
                quickRepliesContainer.style.display = 'none'; // Hide container if no replies
            }
            scrollToBottom(); // Ensure buttons are visible
        }

        // Highlights a specific section in the left panel and switches content
        function displayLeftPanelContent(panelId) {
            // Hide all sections first
            [commonOverviewSection, portfolioDetailsSection, financialGoalsSection, riskControlSection].forEach(sec => {
                sec.classList.add('hidden');
                sec.classList.remove('focused'); // Also remove focus from others
            });

            // Show and focus the target section
            let targetSection;
            switch (panelId) {
                case 'common-overview':
                    targetSection = commonOverviewSection;
                    break;
                case 'portfolio-details':
                    targetSection = portfolioDetailsSection;
                    updatePortfolioDetails(); // Ensure latest data is rendered
                    break;
                case 'financial-goals-details':
                    targetSection = financialGoalsSection;
                    updateFinancialGoals(); // Ensure latest data is rendered
                    break;
                case 'risk-control':
                    targetSection = riskControlSection;
                    updateRiskControl(); // Ensure latest data is rendered
                    break;
                default:
                    targetSection = commonOverviewSection; // Fallback
            }

            if (targetSection) {
                targetSection.classList.remove('hidden');
                targetSection.classList.add('focused');
                targetSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }

        // Helper function to format date strings
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', options);
        }

        // Basic date validation for YYYY-MM-DD
        function isValidDate(dateString) {
            const regex = /^\d{4}-\d{2}-\d{2}$/;
            if (!regex.test(dateString)) return false;
            const date = new Date(dateString);
            return date.toISOString().slice(0, 10) === dateString;
        }

        // --- Left Panel Update Functions ---

        // Updates the Portfolio Summary section in the left panel
        function updatePortfolioDetails() {
            document.getElementById('totalAssets').textContent = `$${portfolioData.totalAssets.toLocaleString()}`;
            const gainLossSpan = document.getElementById('todayGainLoss');
            gainLossSpan.textContent = `${portfolioData.todayGainLoss >= 0 ? '+' : ''}$${Math.abs(portfolioData.todayGainLoss).toLocaleString()} (${portfolioData.todayGainLossPercent >= 0 ? '+' : ''}${portfolioData.todayGainLossPercent}%)`;
            gainLossSpan.className = portfolioData.todayGainLoss >= 0 ? 'gain' : 'loss';

            // Donut Chart
            const donutChart = document.getElementById('assetAllocationChart');
            let conicGradientString = [];
            let currentPercentage = 0;
            portfolioData.breakdown.forEach(item => {
                conicGradientString.push(`${item.color} ${currentPercentage}% ${currentPercentage + item.percentage}%`);
                currentPercentage += item.percentage;
            });
            donutChart.style.background = `conic-gradient(${conicGradientString.join(',')})`;
            donutChart.querySelector('span').textContent = `${portfolioData.breakdown[0].percentage}% ${portfolioData.breakdown[0].type}`; // Display first type for simplicity
            
            const legendDiv = document.getElementById('assetBreakdownLegend');
            legendDiv.innerHTML = portfolioData.breakdown.map(item => `
                <div class="legend-item">
                    <span class="legend-color" style="background-color: ${item.color};"></span>
                    ${item.type} (${item.percentage}%)
                </div>
            `).join('');

            // Stacked Bar Chart
            const balanceHistoryChart = document.getElementById('balanceHistoryChart');
            balanceHistoryChart.innerHTML = '';
            const maxTotal = Math.max(...portfolioData.history.map(h => h.stocks + h.bonds + h.cash));
            
            portfolioData.history.forEach(data => {
                const totalMonth = data.stocks + data.bonds + data.cash;
                const barSegment = document.createElement('div');
                barSegment.classList.add('bar-segment');
                barSegment.style.height = `${(totalMonth / maxTotal) * 100}%`;
                barSegment.style.setProperty('--num-bars', portfolioData.history.length);

                const stocksHeight = (data.stocks / totalMonth) * 100;
                const bondsHeight = (data.bonds / totalMonth) * 100;
                const cashHeight = (data.cash / totalMonth) * 100;

                barSegment.innerHTML = `
                    <span style="--segment-color: var(--portfolio-stock); --segment-height: ${stocksHeight}%;"></span>
                    <span style="--segment-color: var(--portfolio-bond); --segment-height: ${bondsHeight}%;"></span>
                    <span style="--segment-color: var(--portfolio-cash); --segment-height: ${cashHeight}%;"></span>
                    <div class="bar-label">$${totalMonth.toLocaleString()}</div>
                `;
                balanceHistoryChart.appendChild(barSegment);
            });
        }

        // Updates the Financial Goals section in the left panel
        function updateFinancialGoals() {
            financialGoalsList.innerHTML = ''; // Clear existing goals
            userGoals.forEach(goal => {
                const goalItem = document.createElement('div');
                goalItem.classList.add('goal-item');
                const progressPercentage = Math.round((goal.currentAmount / goal.targetAmount) * 100);
                
                goalItem.innerHTML = `
                    <div class="goal-header">
                        <h5>${goal.name}</h5>
                        <div class="progress-text">${progressPercentage}% Complete</div>
                    </div>
                    <p>Target: $${goal.targetAmount.toLocaleString()} | Current: $${goal.currentAmount.toLocaleString()}</p>
                    <p>Target Date: ${formatDate(goal.targetDate)}</p>
                    <div class="circular-progress" style="--progress-percent: ${progressPercentage}%;">
                        <span>${progressPercentage}%</span>
                    </div>
                `;
                financialGoalsList.appendChild(goalItem);
            });
        }

        // Updates the Risk Control section in the left panel
        function updateRiskControl() {
            document.getElementById('userRiskLevel').textContent = userRiskProfile.level;
            const riskAssessmentList = riskControlSection.querySelector('.risk-assessment ul');
            riskAssessmentList.innerHTML = userRiskProfile.recommendations.map(rec => `<li>${rec}</li>`).join('');
        }

        // Show goal comparison after adjustment
        function showGoalComparison(oldGoal, newGoal) {
            goalComparisonDiv.innerHTML = `
                <p><strong>Goal Adjusted: ${newGoal.name}</strong></p>
                <p>
                    <strong>Old Target Amount:</strong> <span class="old-value">$${oldGoal.targetAmount.toLocaleString()}</span>
                    <strong>New Target Amount:</strong> <span class="new-value">$${newGoal.targetAmount.toLocaleString()}</span>
                </p>
                <p>
                    <strong>Old Target Date:</strong> <span class="old-value">${formatDate(oldGoal.targetDate)}</span>
                    <strong>New Target Date:</strong> <span class="new-value">${formatDate(newGoal.targetDate)}</span>
                </p>
            `;
            goalComparisonDiv.style.display = 'block';
            setTimeout(() => {
                goalComparisonDiv.style.display = 'none'; // Hide after 5 seconds
            }, 5000);
        }

        // --- Main Bot Conversation Logic ---

        function handleUserInput(message, isQuickReply = false) {
            const input = isQuickReply ? message : messageInput.value.trim();

            if (!input) return;

            // Immediately append user message
            appendMessage('user', input);
            if (!isQuickReply) {
                messageInput.value = ''; // Only clear input if not a quick reply
            }

            const typingIndicator = showTypingIndicator();

            // Simulate network latency
            setTimeout(() => {
                removeTypingIndicator(typingIndicator);
                processBotResponse(input);
            }, 800 + Math.random() * 700);
        }

        function processBotResponse(userInput) {
            let botMessage = '';
            let quickReplies = [];
            const lowerCaseInput = userInput.toLowerCase();

            // --- Goal Setting Flow (Multi-turn conversation) ---
            if (currentStep === 'goal_setting_start') {
                botMessage = 'Great! What is the name of your new financial goal? (e.g., "Dream Vacation", "Child\'s Education")';
                quickReplies = ['Cancel'];
                currentStep = 'goal_name_input';
                displayLeftPanelContent('financial-goals-details');
            } else if (currentStep === 'goal_name_input') {
                currentGoal.name = userInput;
                botMessage = `Understood. What is the target amount for "${currentGoal.name}"? Please provide a number (e.g., 50000).`;
                quickReplies = ['Cancel'];
                currentStep = 'goal_amount_input';
            } else if (currentStep === 'goal_amount_input') {
                const amount = parseFloat(userInput.replace(/[^0-9.]/g, '')); // Clean input for numbers
                if (!isNaN(amount) && amount > 0) {
                    currentGoal.targetAmount = amount;
                    currentGoal.currentAmount = 0; // New goal starts at 0
                    botMessage = `Excellent. By when do you plan to achieve this goal? Please provide a date in YYYY-MM-DD format (e.g., "2027-12-31").`;
                    quickReplies = ['Cancel'];
                    currentStep = 'goal_date_input';
                } else {
                    botMessage = 'That doesn\'t look like a valid amount. Please enter a numerical value for your goal target (e.g., 50000).';
                    quickReplies = ['Cancel'];
                    // Stay in current step
                }
            } else if (currentStep === 'goal_date_input') {
                if (isValidDate(userInput)) {
                    currentGoal.targetDate = userInput;
                    currentGoal.id = currentGoal.name.toLowerCase().replace(/\s/g, '_'); // Simple ID for demo
                    userGoals.push(currentGoal); // Add to our mock data
                    updateFinancialGoals(); // Update left panel
                    displayLeftPanelContent('financial-goals-details'); // Re-highlight/keep highlight on goal section
                    botMessage = `Fantastic! Your goal "${currentGoal.name}" with a target of $${currentGoal.targetAmount.toLocaleString()} by ${formatDate(currentGoal.targetDate)} has been added to your dashboard. What else can I assist you with?`;
                    quickReplies = ['View Goals', 'Check Portfolio', 'Contact Support', 'Main Menu'];
                    currentStep = 'initial'; // Reset state
                    currentGoal = {}; // Clear temp goal data
                } else {
                    botMessage = 'That\'s not a valid date format. Please use YYYY-MM-DD (e.g., "2027-12-31").';
                    quickReplies = ['Cancel'];
                }
            } 
            // --- Goal Adjustment Flow (Using inline inputs) ---
            else if (currentStep === 'adjust_goal_select') {
                // Try to find the goal by name, case-insensitive
                const matchedGoal = userGoals.find(g => lowerCaseInput.includes(g.name.toLowerCase()));
                if (matchedGoal) {
                    adjustingGoalId = matchedGoal.id;
                    oldGoalSnapshot = { ...matchedGoal }; // Snapshot for comparison
                    botMessage = `Okay, you want to adjust "${matchedGoal.name}". What do you want to change? The <b>target amount</b> or the <b>target date</b>?`;
                    quickReplies = ['Change Amount', 'Change Date', 'Cancel Adjustment'];
                    currentStep = 'adjust_goal_property';
                    displayLeftPanelContent('financial-goals-details');
                } else {
                    botMessage = `I couldn't find a goal named "${userInput}". Please choose from your existing goals: ${userGoals.map(g => `<b>${g.name}</b>`).join(', ')} or type "Cancel Adjustment".`;
                    quickReplies = userGoals.map(g => g.name).concat('Cancel Adjustment');
                }
            } else if (currentStep === 'adjust_goal_property') {
                const goalToAdjust = userGoals.find(g => g.id === adjustingGoalId);
                if (!goalToAdjust) {
                    botMessage = 'It seems there was an issue. Please try adjusting a goal again.';
                    quickReplies = ['Adjust a Goal', 'Main Menu'];
                    currentStep = 'initial';
                    adjustingGoalId = null;
                    adjustingProperty = null;
                } else if (lowerCaseInput.includes('amount')) {
                    adjustingProperty = 'amount';
                    const amountMessageDiv = appendMessage('bot', `
                        What is the new target amount for "<strong>${goalToAdjust.name}</strong>"?
                        <div class="inline-adjust-controls">
                            <label for="amountSlider">Set New Amount:</label>
                            <input type="range" id="amountSlider" min="${goalToAdjust.currentAmount}" max="${goalToAdjust.targetAmount * 2}" value="${goalToAdjust.targetAmount}" step="1000">
                            <div class="control-value" id="currentAmountValue">$${goalToAdjust.targetAmount.toLocaleString()}</div>
                            <button class="confirm-button" id="confirmAmount">Confirm Amount</button>
                        </div>
                    `, true);
                    setupSliderListener(amountMessageDiv, goalToAdjust, 'amount', 'amountSlider', 'currentAmountValue', 'confirmAmount');
                    currentStep = 'waiting_for_inline_input'; // Wait for inline input
                } else if (lowerCaseInput.includes('date')) {
                    adjustingProperty = 'date';
                    const dateMessageDiv = appendMessage('bot', `
                        What is the new target date for "<strong>${goalToAdjust.name}</strong>"?
                        <div class="inline-adjust-controls">
                            <label for="datePicker">Select New Date:</label>
                            <input type="date" id="datePicker" value="${goalToAdjust.targetDate}">
                            <button class="confirm-button" id="confirmDate">Confirm Date</button>
                        </div>
                    `, true);
                    setupDatePickerListener(dateMessageDiv, goalToAdjust, 'date', 'datePicker', 'confirmDate');
                    currentStep = 'waiting_for_inline_input'; // Wait for inline input
                } else {
                    botMessage = 'Please specify if you want to change the <b>amount</b> or the <b>date</b> for this goal.';
                    quickReplies = ['Change Amount', 'Change Date', 'Cancel Adjustment'];
                }
            }
            // Logic for "waiting_for_inline_input" is handled by the inline event listeners, not by direct userInput processing here.
            // When an inline button is clicked, it will call handleInlineInputConfirm.

            // --- Cancel any multi-turn flow ---
            else if (lowerCaseInput === 'cancel' || lowerCaseInput === 'cancel adjustment') {
                botMessage = 'Operation cancelled. Is there anything else I can help you with?';
                quickReplies = ['My Portfolio', 'Set a Goal', 'Adjust a Goal', 'Main Menu'];
                currentStep = 'initial';
                currentGoal = {};
                adjustingGoalId = null;
                adjustingProperty = null;
                oldGoalSnapshot = null;
                displayLeftPanelContent('common-overview'); // Go back to common view
            }
            // --- General Conversation Flow ---
            else {
                switch (lowerCaseInput) {
                    case 'hello':
                    case 'hi':
                    case 'hey':
                        botMessage = 'Hello! I am Quantum Wealth AI, your smart financial advisor. How can I assist you today?';
                        quickReplies = ['My Portfolio', 'Set a Goal', 'Adjust a Goal', 'Investment Options', 'My Risk Profile', 'Contact Support'];
                        currentStep = 'initial';
                        displayLeftPanelContent('common-overview');
                        break;

                    case 'my portfolio':
                    case 'check portfolio':
                    case 'portfolio summary':
                        displayLeftPanelContent('portfolio-details'); // Switch to portfolio details
                        botMessage = 'Sure! Your current total assets are <strong>$' + portfolioData.totalAssets.toLocaleString() + '</strong>. Your portfolio ' + 
                                     (portfolioData.todayGainLoss >= 0 ? 'gained' : 'lost') + 
                                     ' <strong>$' + Math.abs(portfolioData.todayGainLoss).toLocaleString() + ' (' + 
                                     (portfolioData.todayGainLossPercent >= 0 ? '+' : '') + portfolioData.todayGainLossPercent + '%)</strong> today. ' +
                                     'You can see the detailed breakdown on the left. Would you like insights or to explore investment options?';
                        quickReplies = ['Portfolio Insights', 'Explore Investment Options', 'Back to main menu'];
                        currentStep = 'portfolio_inquiry';
                        break;

                    case 'detailed breakdown':
                        displayLeftPanelContent('portfolio-details'); // Ensure portfolio details is visible
                        botMessage = 'Your portfolio is currently allocated as: ' + 
                                     portfolioData.breakdown.map(item => `${item.percentage}% ${item.type}`).join(', ') + 
                                     '. You can review this on your left dashboard.';
                        quickReplies = ['Portfolio Insights', 'Back to main menu'];
                        currentStep = 'portfolio_inquiry';
                        break;

                    case 'portfolio insights':
                        botMessage = 'Based on your current allocation, consider diversifying more into emerging markets for potential growth, or increasing your bond allocation if stability is a priority. Would you like to explore investment options?';
                        quickReplies = ['Explore Investment Options', 'Back to main menu'];
                        currentStep = 'investment_suggestion';
                        break;

                    case 'set a goal':
                    case 'set new goal':
                    case 'add goal':
                        displayLeftPanelContent('financial-goals-details'); // Switch to goals details
                        botMessage = 'Absolutely! I can help you set a new financial goal. What is the name of your new goal? (e.g., "Dream Vacation", "Child\'s Education")';
                        quickReplies = ['Cancel'];
                        currentStep = 'goal_name_input'; // Initiate goal setting flow
                        break;

                    case 'adjust a goal':
                    case 'modify goal':
                    case 'change goal':
                        displayLeftPanelContent('financial-goals-details'); // Switch to goals details
                        if (userGoals.length > 0) {
                            botMessage = `Which goal would you like to adjust? Your current goals are: ${userGoals.map(g => `<b>${g.name}</b>`).join(', ')}.`;
                            quickReplies = userGoals.map(g => g.name).concat('Cancel Adjustment');
                            currentStep = 'adjust_goal_select'; // Initiate goal adjustment flow
                        } else {
                            botMessage = 'You don\'t have any goals set yet. Would you like to set a new one?';
                            quickReplies = ['Set New Goal', 'Back to main menu'];
                            currentStep = 'initial';
                        }
                        break;

                    case 'view goals':
                    case 'my goals':
                    case 'financial goals':
                        displayLeftPanelContent('financial-goals-details'); // Switch to goals details
                        if (userGoals.length > 0) {
                            let goalsSummary = 'Here are your current financial goals:<ul>';
                            userGoals.forEach(goal => {
                                const progress = Math.round((goal.currentAmount / goal.targetAmount) * 100);
                                goalsSummary += `<li><strong>${goal.name}</strong>: Target $${goal.targetAmount.toLocaleString()}, ${progress}% completed by ${formatDate(goal.targetDate)}.</li>`;
                            });
                            goalsSummary += '</ul>Would you like to set a new goal, adjust an existing one, or get insights on your goals?';
                            quickReplies = ['Set New Goal', 'Adjust a Goal', 'Get Goal Insights', 'Back to main menu'];
                        } else {
                            botMessage = 'You currently have no financial goals set. Would you like to set one now?';
                            quickReplies = ['Set New Goal', 'Back to main menu'];
                        }
                        currentStep = 'initial';
                        break;

                    case 'my risk profile':
                    case 'risk assessment':
                    case 'risk control':
                        displayLeftPanelContent('risk-control'); // Switch to risk control details
                        botMessage = `Your current risk profile is <strong>${userRiskProfile.level}</strong>. We aim to balance your investments with your comfort for risk. You can see detailed insights and recommendations on the left.`;
                        quickReplies = ['Review Risk Tolerance', 'Back to main menu'];
                        currentStep = 'risk_inquiry';
                        break;

                    case 'investment options':
                    case 'explore investment options':
                        botMessage = 'We offer a wide range of investment options, including diversified mutual funds, ETFs, fixed income products, and personalized wealth management solutions. What type of investment are you interested in?';
                        quickReplies = ['Mutual Funds', 'ETFs', 'Wealth Management', 'Back to main menu'];
                        currentStep = 'investment_options';
                        break;

                    case 'mutual funds':
                        botMessage = 'Our mutual funds cover various sectors and risk profiles. Do you prefer high-growth, balanced, or conservative funds?';
                        quickReplies = ['High-Growth Funds', 'Balanced Funds', 'Conservative Funds', 'Back to Investment Options'];
                        currentStep = 'fund_type_selection';
                        break;

                    case 'etfs':
                        botMessage = 'ETFs offer diversification and flexibility. Are you looking for market-tracking ETFs, sector-specific, or international ETFs?';
                        quickReplies = ['Market ETFs', 'Sector ETFs', 'International ETFs', 'Back to Investment Options'];
                        currentStep = 'etf_type_selection';
                        break;
                    
                    case 'wealth management':
                        botMessage = 'Our personalized wealth management services provide tailored strategies for high-net-worth individuals and families. Would you like to schedule a consultation with a senior advisor?';
                        quickReplies = ['Schedule Consultation', 'Back to Investment Options'];
                        currentStep = 'wealth_management_inquiry';
                        break;

                    case 'contact support':
                    case 'human agent':
                        botMessage = 'If you need to speak with a human, you can call us at <strong>+1 (800) 555-1234</strong> during business hours (9 AM - 5 PM EST, Mon-Fri), or you can leave a message and we will get back to you.';
                        quickReplies = ['Leave a Message', 'Back to main menu'];
                        currentStep = 'initial';
                        break;
                    
                    case 'back to main menu':
                    case 'main menu':
                        displayLeftPanelContent('common-overview'); // Go back to common overview
                        botMessage = 'What else can I assist you with?';
                        quickReplies = ['My Portfolio', 'Set a Goal', 'Adjust a Goal', 'Investment Options', 'My Risk Profile', 'Contact Support'];
                        currentStep = 'initial';
                        break;

                    default:
                        botMessage = 'I apologize, I didn\'t quite understand that. Could you please rephrase, or choose one of the options below?';
                        quickReplies = ['My Portfolio', 'Set a Goal', 'Adjust a Goal', 'Investment Options', 'My Risk Profile', 'Contact Support', 'Main Menu'];
                        currentStep = 'initial'; // Reset to initial if bot can't understand
                        displayLeftPanelContent('common-overview'); // Fallback to common overview
                        break;
                }
            }

            appendMessage('bot', botMessage);
            addQuickReplies(quickReplies);
        }

        // --- Inline Input Helper Functions ---

        // Sets up listener for the amount slider
        function setupSliderListener(messageDiv, goal, property, sliderId, valueDisplayId, confirmButtonId) {
            const slider = messageDiv.querySelector(`#${sliderId}`);
            const valueDisplay = messageDiv.querySelector(`#${valueDisplayId}`);
            const confirmBtn = messageDiv.querySelector(`#${confirmButtonId}`);

            slider.oninput = function() {
                valueDisplay.textContent = `$${parseInt(this.value).toLocaleString()}`;
                // Update track fill for range input
                const percent = ((this.value - this.min) / (this.max - this.min)) * 100;
                slider.style.setProperty('--fill-percent', `${percent}%`);
            };
            // Set initial fill
            const initialPercent = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
            slider.style.setProperty('--fill-percent', `${initialPercent}%`);

            confirmBtn.onclick = function() {
                handleInlineInputConfirm(goal.id, property, parseInt(slider.value));
            };
        }

        // Sets up listener for the date picker
        function setupDatePickerListener(messageDiv, goal, property, datePickerId, confirmButtonId) {
            const datePicker = messageDiv.querySelector(`#${datePickerId}`);
            const confirmBtn = messageDiv.querySelector(`#${confirmButtonId}`);

            confirmBtn.onclick = function() {
                handleInlineInputConfirm(goal.id, property, datePicker.value);
            };
        }

        // Handles confirmation from inline inputs
        function handleInlineInputConfirm(goalId, property, newValue) {
            const goalIndex = userGoals.findIndex(g => g.id === goalId);
            if (goalIndex !== -1) {
                const goal = userGoals[goalIndex];
                
                // Perform update
                if (property === 'amount') {
                    goal.targetAmount = newValue;
                    appendMessage('user', `Confirmed new target amount: $${newValue.toLocaleString()}`);
                } else if (property === 'date') {
                    goal.targetDate = newValue;
                    appendMessage('user', `Confirmed new target date: ${formatDate(newValue)}`);
                }

                updateFinancialGoals(); // Update left panel
                displayLeftPanelContent('financial-goals-details'); // Re-highlight
                showGoalComparison(oldGoalSnapshot, goal); // Show comparison

                // Reset state
                currentStep = 'initial';
                adjustingGoalId = null;
                adjustingProperty = null;
                oldGoalSnapshot = null;

                appendMessage('bot', `The ${property} for "${goal.name}" has been updated on your dashboard. What else can I help with?`);
                addQuickReplies(['View Goals', 'Check Portfolio', 'Main Menu']);
            } else {
                appendMessage('bot', 'Oops, something went wrong while updating the goal. Please try again or contact support.');
                addQuickReplies(['Adjust a Goal', 'Main Menu']);
                currentStep = 'initial';
                adjustingGoalId = null;
                adjustingProperty = null;
                oldGoalSnapshot = null;
            }
        }

        // --- Event Listeners & Initial Load ---

        sendButton.addEventListener('click', () => handleUserInput());
        messageInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                handleUserInput();
            }
        });
        addGoalButton.addEventListener('click', () => {
            handleUserInput('Set a Goal', true); // Simulate quick reply click
        });

        // Initial welcome message and dashboard setup
        document.addEventListener('DOMContentLoaded', () => {
            appendMessage('bot', 'Hello! I am Quantum Wealth AI, your smart financial advisor. How can I assist you today?');
            addQuickReplies(['My Portfolio', 'Set a Goal', 'Adjust a Goal', 'Investment Options', 'My Risk Profile', 'Contact Support']);
            displayLeftPanelContent('common-overview'); // Show common overview initially
        });

    </script>
</body>
</html>